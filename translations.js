// Translation Data for Africa Travel Biz
const translations = {
    en: {
        nav: {
            services: "Services",
            solution: "Solution",
            whyUs: "Why us",
            cases: "Case studies",
            contact: "Contact",
            consultation: "Free consultation",
            language: "EN"
        },
        hero: {
            title: "Smooth, Safe, and Reliable Business Trips & Research in Africa.",
            description: "Supporting your business in Africa through trusted local networks and Japanese-quality coordination.",
            cta: "Request a Free Consultation — No Obligation",
            stats: {
                countries: "African Countries",
                local: "Customer Support",
                support: "Response Time"
            }
        },
        problem: {
            title: "Are you facing these challenges with your business trip or research in Africa?",
            issues: {
                visa: {
                    title: "Not sure about visa or vaccination requirements?",
                    desc: "Planning a business trip to Africa but unsure about entry requirements, visas, or necessary vaccinations? We provide comprehensive guidance."
                },
                transfer: {
                    title: "Unclear how to arrange airport transfers?",
                    desc: "Navigating airport transfers in unfamiliar African cities can be challenging. We coordinate safe and reliable transportation."
                },
                hotel: {
                    title: "Worried whether online-listed hotels are safe and clean?",
                    desc: "Concerned about hotel quality and safety? Our local network ensures accommodation recommendations meet your standards."
                },
                interpreter: {
                    title: "Need interpreters or coordinators you can actually trust?",
                    desc: "Finding reliable local interpreters and coordinators is crucial. We connect you with vetted professionals you can depend on."
                },
                meeting: {
                    title: "Struggling to coordinate meetings or schedules with local companies or organizations?",
                    desc: "Time-consuming schedule coordination with local partners? We handle the logistics so you can focus on your business goals."
                },
                business: {
                    title: "Unsure how to turn what you learned during the trip into an actual business opportunity?",
                    desc: "Turn your research findings into actionable business strategies. We help transform insights into concrete opportunities."
                }
            }
        },
        solution: {
            subtitle: "Our Solution",
            title: "The Only Concierge Directly Connected with Africa.",
            description: "Leveraging networks built through JICA and the Tokyo 2020 Olympic Committee, we work directly with trusted local partners across Africa — ensuring safe, flexible, and cost-efficient support."
        },
        role: {
            subtitle: "Our Role",
            title: "We Are Not a Travel Agency — We're Your Business Concierge in Africa.",
            description: "We coordinate the best local people, locations, and resources based on your goals and budget. Our focus is not just on arrangements, but on strategies that drive results.<br /><br /><em>\"Giving your company the same peace of mind as having a trusted local friend.\"</em>"
        },
        services: {
            title: "Our Services",
            subtitle: "Service Categories",
            cta: "Request Service Details",
            "1": {
                title: "Business Trip & Site Visit Support",
                desc: "Visa & safety guidance / Accommodation & transport suggestions / Interpreter introductions"
            },
            "2": {
                title: "Local Research & Media Delegation",
                desc: "On-site research, photography, video, and interviews on your behalf."
            },
            "3": {
                title: "Business & Project Support",
                desc: "Coordination and assistance for business meetings, CSR, or field studies."
            },
            "4": {
                title: "Promotion & PR Support",
                desc: "Support for filming, PR content creation, and social media storytelling."
            },
            "5": {
                title: "Safety & Emergency Support",
                desc: "Emergency response and on-site support for medical, security, or travel issues."
            }
        },
        strengths: {
            subtitle: "Why Choose Us",
            title: "Our Competitive Advantages",
            description: "What Sets Us Apart",
            "1": {
                title: "Trusted Network Across 54 Countries",
                desc: "Trusted network across 54 African countries"
            },
            "2": {
                title: "Direct Coordination for Efficiency",
                desc: "Direct coordination for speed and cost efficiency"
            },
            "3": {
                title: "Japan-Based Support Team",
                desc: "End-to-end support by Japan-based specialists"
            },
            "4": {
                title: "Multilingual Operation",
                desc: "Multilingual operation (JP / EN / FR)"
            },
            "5": {
                title: "Creating Social Impact",
                desc: "Creating local employment and social impact"
            }
        },
        cases: {
            subtitle: "Case Studies",
            title: "Client Success Stories",
            cta: "Inquire About More Cases",
            "1": {
                title: "Transportation Company A (Kenya)",
                desc: "Business coordination, interpreter assignment, secure mobility support"
            },
            "2": {
                title: "University Research Lab B (Tanzania)",
                desc: "Interpreter introduction, lodging suggestions, research route design"
            },
            "3": {
                title: "Trading Firm C (Ethiopia)",
                desc: "Local product shooting, interview delegation, and video material production"
            },
            "4": {
                title: "NGO Organization D (Uganda)",
                desc: "NGO Organization D (Uganda): Conducted local partner research and interviews, providing audio, images, and a summarized report."
            },
            "5": {
                title: "Startup E (Rwanda)",
                desc: "Startup E (Rwanda): Designed and coordinated a business tour including company visits, university links, and investor meetups."
            },
            "6": {
                title: "Media Production F (Morocco)",
                desc: "Media Production F (Morocco): Supported documentary filming through permit coordination and on-site logistics, enabling a successful shoot within a tight schedule."
            }
        },
        flow: {
            subtitle: "How It Works",
            title: "Our Process",
            cta: "Even first-time clients receive full support from a dedicated consultant.",
            steps: {
                "1": {
                    title: "Contact Us",
                    desc: "Get in touch with your needs and goals"
                },
                "2": {
                    title: "Hearing & Consultation",
                    desc: "We understand your requirements in detail"
                },
                "3": {
                    title: "Proposal & Estimate",
                    desc: "We provide a tailored proposal and cost estimate"
                },
                "4": {
                    title: "Agreement & Preparation",
                    desc: "We finalize details and prepare for execution"
                },
                "5": {
                    title: "Execution, Reporting & After-Support",
                    desc: "We implement, report, and provide ongoing support"
                }
            }
        },
        finalCta: {
            subtitle: "Get Started Today",
            title: "Request a Free Consultation — No Obligation",
            description: "First consultation is free. Feel free to contact us."
        },
        contact: {
            info: {
                title: "Get in Touch",
                description: "We typically respond within 24 hours. For urgent matters, please contact us directly. All initial consultations are confidential and non-binding."
            },
            details: {
                email: "Email",
                office: "Office",
                location: "Tokyo, Japan",
                addressNote: "(Exact address shared after initial consultation)"
            },
            hours: {
                title: "Business Hours",
                weekdays: "Monday – Friday: 9:00 AM – 6:00 PM JST",
                weekends: "Weekend consultations available by appointment"
            },
            form: {
                name: "Name *",
                namePlaceholder: "Tanaka Taro",
                company: "Company Name *",
                companyPlaceholder: "ABC Corporation",
                email: "Email Address *",
                emailPlaceholder: "tanaka@example.com",
                phone: "Phone Number",
                phonePlaceholder: "+81-90-xxxx-xxxx (optional)",
                message: "Message *",
                messagePlaceholder: "Tell us about your business needs, timeline, or any specific questions...",
                submit: "Send Message",
                disclaimer: "By submitting, you agree to our privacy policy. We will not share your information with third parties."
            }
        },
        footer: {
            companyName: "Africa Travel Biz",
            description: "Your concierge for safe, smooth, and reliable business trips and research in Africa.<br>From Tokyo to Africa, we walk alongside your business ambitions.",
            services: {
                title: "Services",
                travel: "Business Trip Support",
                research: "Local Research",
                business: "Project Support",
                safety: "Emergency Support"
            },
            regions: {
                title: "Regions",
                eastAfrica: "East Africa",
                westAfrica: "West Africa",
                southAfrica: "Central & Southern Africa"
            },
            copyright: "© 2024 Africa Travel Biz. All rights reserved.",
            privacy: "Privacy Policy",
            terms: "Terms of Service",
            contact: "Contact"
        },
        toast: {
            success: "Message sent successfully! We'll respond within 24 hours."
        }
    },
    ja: {
        nav: {
            services: "サービス",
            solution: "解決策",
            whyUs: "強み",
            cases: "導入事例",
            contact: "お問い合わせ",
            consultation: "無料相談",
            language: "JP"
        },
        hero: {
            title: "アフリカ出張・視察を<br />安心・安全・スムーズに。",
            description: "現地ネットワーク × 日本品質で、貴社のアフリカビジネスを支援します。",
            cta: "とりあえず気軽に無料相談",
            stats: {
                countries: "アフリカ54カ国",
                local: "カスタマーサポート",
                support: "レスポンス時間"
            }
        },
        problem: {
            title: "アフリカ出張や視察で<br />こんなお悩みはありませんか？",
            issues: {
                visa: {
                    title: "ビザやワクチンなど、渡航に必要なものがわからない",
                    desc: "アフリカ出張の準備を進めているが、入国要件やビザ、必要なワクチンについて不明な点が多い。包括的なガイダンスを提供します。"
                },
                transfer: {
                    title: "空港送迎の方法がわからない",
                    desc: "慣れないアフリカの都市での空港送迎は難しいもの。安全で信頼性の高い交通手段をコーディネートします。"
                },
                hotel: {
                    title: "ネットで見つけたホテルが安全で清潔か不安",
                    desc: "ホテルの質や安全性が心配？現地ネットワークを通じて、あなたの基準を満たす宿泊施設を紹介します。"
                },
                interpreter: {
                    title: "通訳や現地コーディネーターを探したいが、信頼できる人が見つからない",
                    desc: "信頼できる現地通訳やコーディネーターを見つけることは重要です。審査済みのプロフェッショナルをご紹介します。"
                },
                meeting: {
                    title: "現地企業や団体とのアポ調整が難しく、スケジュール管理に時間がかかる",
                    desc: "現地パートナーとのスケジュール調整に時間がかかる？私たちがロジスティクスを担当するので、ビジネス目標に集中できます。"
                },
                business: {
                    title: "視察で得た情報をどう事業化につなげるか分からない",
                    desc: "調査結果を実行可能なビジネス戦略に変える。私たちは洞察を具体的な機会に変換するお手伝いをします。"
                }
            }
        },
        solution: {
            subtitle: "私たちの解決策",
            title: "現地と直接つながる、唯一の「アフリカ出張コンシェルジュ」",
            description: "JICA海外協力隊やTokyo 2020組織委員会で築いたネットワークを活かし、アフリカ全域の現地パートナーと直接連携。安心・柔軟・低コストな現地支援を実現。"
        },
        role: {
            subtitle: "私たちの役割",
            title: "私たちは旅行代理店ではなく<br />アフリカビジネスのコンシェルジュです。",
            description: "貴社の目的・予算・条件に合わせて、最適な人・場所・リソースを直接コーディネート。単なる手配ではなく、成果を出すための現地戦略づくりを支援します。"
        },
        services: {
            title: "サービス内容",
            subtitle: "サービスカテゴリー",
            cta: "サービスの詳細を相談する",
            "1": {
                title: "出張・視察サポート",
                desc: "ビザ・安全情報の案内／宿泊・移動の提案／通訳の紹介"
            },
            "2": {
                title: "現地調査・取材代行",
                desc: "現地リサーチ・写真・映像・インタビューの代行取得"
            },
            "3": {
                title: "ビジネス・プロジェクト支援",
                desc: "現地商談・調査・CSR活動の調整・実施支援"
            },
            "4": {
                title: "プロモーション・広報",
                desc: "撮影・取材同行、SNS・広報素材の制作サポート"
            },
            "5": {
                title: "安全・緊急サポート",
                desc: "医療・治安・移動トラブルの緊急対応・現地支援"
            }
        },
        strengths: {
            subtitle: "なぜ選ばれるのか",
            title: "強み",
            description: "私たちの競争優位性",
            "1": {
                title: "アフリカ54カ国に広がる信頼ネットワーク",
                desc: "アフリカ54カ国に広がる信頼できるネットワーク"
            },
            "2": {
                title: "現地直結でスピード・コスト効率に優れる",
                desc: "スピードとコスト効率のための直接的なコーディネーション"
            },
            "3": {
                title: "日本人スタッフが一貫サポート",
                desc: "日本を拠点とする専門家による完全なサポート"
            },
            "4": {
                title: "多言語対応（日本語・英語・フランス語）",
                desc: "多言語対応（日本語・英語・フランス語）"
            },
            "5": {
                title: "現地雇用を生む社会的インパクト",
                desc: "現地雇用の創出と社会的インパクトの創出"
            }
        },
        cases: {
            subtitle: "導入事例",
            title: "導入事例",
            cta: "他の事例について問い合わせる",
            "1": {
                title: "運送業A社（ケニア）",
                desc: "商談調整・通訳アサイン・安全移動サポート"
            },
            "2": {
                title: "大学B研究室（タンザニア）",
                desc: "通訳紹介・宿泊提案・調査ルート設計"
            },
            "3": {
                title: "大手商社C社（エチオピア）",
                desc: "現地商材撮影・取材代行・映像素材提供"
            },
            "4": {
                title: "NGO団体D（ウガンダ）",
                desc: "現地パートナー調査・インタビュー代行・報告書作成支援"
            },
            "5": {
                title: "スタートアップE社（ルワンダ）",
                desc: "視察プラン提案・現地コーディネート・成果報告支援"
            },
            "6": {
                title: "メディア制作F社（モロッコ）",
                desc: "ドキュメンタリー撮影支援・取材調整・ロケコーディネート"
            }
        },
        flow: {
            subtitle: "ご利用の流れ",
            title: "ご利用の流れ",
            cta: "初めてでも、専任担当がしっかり伴走します。",
            steps: {
                "1": {
                    title: "お問い合わせ",
                    desc: "ニーズと目標についてご連絡ください"
                },
                "2": {
                    title: "ヒアリング",
                    desc: "詳細な要件を確認いたします"
                },
                "3": {
                    title: "ご提案・見積",
                    desc: "ご要望に合わせた提案と見積もりを提供します"
                },
                "4": {
                    title: "ご契約・準備",
                    desc: "詳細を確定し、実行準備を行います"
                },
                "5": {
                    title: "実施・報告・アフターサポート",
                    desc: "実行、報告、継続的なサポートを提供します"
                }
            }
        },
        finalCta: {
            subtitle: "今すぐ始める",
            title: "とりあえず気軽に無料相談を予約する",
            description: "初回相談は無料です。お気軽にお問い合わせください。"
        },
        contact: {
            info: {
                title: "お問い合わせ",
                description: "通常24時間以内にご返信いたします。緊急の場合は、直接お電話ください。すべての初期相談は機密保持され、拘束力はありません。"
            },
            details: {
                email: "メール",
                office: "オフィス",
                location: "東京、日本",
                addressNote: "（正確な住所は初回相談後にお知らせします）"
            },
            hours: {
                title: "営業時間",
                weekdays: "月曜日〜金曜日：9:00 AM〜6:00 PM JST",
                weekends: "週末の相談は予約制で可能です"
            },
            form: {
                name: "お名前 *",
                namePlaceholder: "田中太郎",
                company: "会社名 *",
                companyPlaceholder: "ABC株式会社",
                email: "メールアドレス *",
                emailPlaceholder: "tanaka@example.com",
                phone: "電話番号",
                phonePlaceholder: "+81-90-xxxx-xxxx（任意）",
                message: "メッセージ *",
                messagePlaceholder: "ビジネスのニーズ、タイムライン、または具体的なご質問についてお聞かせください...",
                submit: "メッセージを送信",
                disclaimer: "送信することで、プライバシーポリシーに同意したものとみなされます。第三者と情報を共有することはありません。"
            }
        },
        footer: {
            companyName: "Africa Travel Biz",
            description: "アフリカでの安全でスムーズで信頼性の高いビジネス旅行と研究のためのコンシェルジュ。<br>東京からアフリカへ、貴社のビジネス野望をともに歩みます。",
            services: {
                title: "サービス",
                travel: "出張支援",
                research: "現地調査",
                business: "プロジェクト支援",
                safety: "緊急サポート"
            },
            regions: {
                title: "地域",
                eastAfrica: "東アフリカ",
                westAfrica: "西アフリカ",
                southAfrica: "中央・南アフリカ"
            },
            copyright: "© 2024 Africa Travel Biz. 全著作権所有。",
            privacy: "プライバシーポリシー",
            terms: "利用規約",
            contact: "お問い合わせ"
        },
        toast: {
            success: "メッセージが送信されました。24時間以内にご返信いたします。"
        }
    }
};

/**
 * Translation System for Africa Travel Biz
 * Supports English (en) and Japanese (ja) languages
 * 
 * Features:
 * - URL parameter support (?lang=ja)
 * - localStorage persistence
 * - Fallback to English for missing translations
 * - Dynamic HTML lang attribute updates
 * - Prevents FOUC (Flash of Untranslated Content)
 */

// Valid language codes - only 'en' and 'ja' are supported
const VALID_LANGUAGES = ['en', 'ja'];
const DEFAULT_LANGUAGE = 'en';

// Current active language (defaults to English)
let currentLanguage = DEFAULT_LANGUAGE;

/**
 * Get translation for a given key and language
 * Falls back to English if translation not found in requested language
 * 
 * @param {string} key - Translation key (e.g., 'nav.services')
 * @param {string} language - Language code ('en' or 'ja')
 * @returns {string|null} - Translated text or null if not found
 */
function getTranslation(key, language) {
    // Validate language parameter
    if (!VALID_LANGUAGES.includes(language)) {
        language = DEFAULT_LANGUAGE;
    }
    
    const keys = key.split('.');
    let translation = translations[language];
    
    // Navigate through nested object structure
    for (const k of keys) {
        if (translation && typeof translation === 'object' && translation[k]) {
            translation = translation[k];
        } else {
            // Translation not found in requested language - try English fallback
            if (language !== DEFAULT_LANGUAGE) {
                let fallbackTranslation = translations[DEFAULT_LANGUAGE];
                for (const fk of keys) {
                    if (fallbackTranslation && typeof fallbackTranslation === 'object' && fallbackTranslation[fk]) {
                        fallbackTranslation = fallbackTranslation[fk];
                    } else {
                        return null;
                    }
                }
                return typeof fallbackTranslation === 'string' ? fallbackTranslation : null;
            }
            return null;
        }
    }
    
    // Return translation if it's a string, otherwise null
    return typeof translation === 'string' ? translation : null;
}

/**
 * Apply translations to all elements with data-i18n attributes
 * Updates HTML lang attribute and language toggle buttons
 * 
 * @param {string} language - Language code to apply ('en' or 'ja')
 */
function translatePage(language) {
    // Validate language parameter
    if (!VALID_LANGUAGES.includes(language)) {
        console.warn(`Invalid language: ${language}. Defaulting to ${DEFAULT_LANGUAGE}.`);
        language = DEFAULT_LANGUAGE;
    }
    
    currentLanguage = language;
    
    // Update all elements with data-i18n attribute
    const elements = document.querySelectorAll('[data-i18n]');
    elements.forEach(element => {
        const key = element.getAttribute('data-i18n');
        if (!key) return;
        
        const translation = getTranslation(key, language);
        
        if (translation) {
            // Handle different element types
            if (element.tagName === 'INPUT' && element.type === 'submit') {
                element.value = translation;
            } else if (element.hasAttribute('placeholder')) {
                // Don't override placeholder here - handled separately
                element.textContent = translation;
            } else {
                element.innerHTML = translation;
            }
        }
    });
    
    // Handle placeholder translations separately
    const placeholderElements = document.querySelectorAll('[data-i18n-placeholder]');
    placeholderElements.forEach(element => {
        const key = element.getAttribute('data-i18n-placeholder');
        if (!key) return;
        
        const translation = getTranslation(key, language);
        if (translation) {
            element.placeholder = translation;
        }
    });
    
    // Update language toggle button text
    const languageButtons = document.querySelectorAll('#language-toggle span, #mobile-language-toggle span');
    languageButtons.forEach(button => {
        button.textContent = language === 'en' ? 'EN' : 'JP';
    });
    
    // Update HTML lang attribute for accessibility and SEO
    if (document.documentElement) {
    document.documentElement.lang = language;
}

    // Update meta tags if they exist
    const metaLang = document.querySelector('meta[property="og:locale"]');
    if (metaLang) {
        metaLang.setAttribute('content', language === 'en' ? 'en_US' : 'ja_JP');
    }
}

/**
 * Toggle between English and Japanese
 * Stores preference in localStorage
 * Made globally accessible for onclick handlers
 */
function toggleLanguage() {
    const newLanguage = currentLanguage === 'en' ? 'ja' : 'en';
    translatePage(newLanguage);
    
    // Persist language preference
    try {
    localStorage.setItem('preferredLanguage', newLanguage);
    } catch (e) {
        // localStorage might not be available (private browsing, etc.)
        console.warn('Could not save language preference:', e);
    }
}

/**
 * Get the preferred language from multiple sources:
 * 1. URL parameter (?lang=ja) - highest priority
 * 2. localStorage saved preference
 * 3. Browser language (if Japanese)
 * 4. Default to English
 * 
 * @returns {string} - Language code ('en' or 'ja')
 */
function getPreferredLanguage() {
    // Priority 1: Check URL parameter
    const urlParams = new URLSearchParams(window.location.search);
    const urlLang = urlParams.get('lang');
    if (urlLang && VALID_LANGUAGES.includes(urlLang)) {
        // Save URL preference to localStorage
        try {
            localStorage.setItem('preferredLanguage', urlLang);
        } catch (e) {
            // Ignore localStorage errors
        }
        return urlLang;
    }
    
    // Priority 2: Check localStorage
    try {
        const savedLang = localStorage.getItem('preferredLanguage');
        if (savedLang && VALID_LANGUAGES.includes(savedLang)) {
            return savedLang;
        }
    } catch (e) {
        // localStorage might not be available
    }
    
    // Priority 3: Check browser language (only if Japanese)
    const browserLang = navigator.language || navigator.userLanguage;
    if (browserLang && (browserLang.startsWith('ja') || browserLang.toLowerCase().startsWith('ja-'))) {
        return 'ja';
    }
    
    // Default: English
    return DEFAULT_LANGUAGE;
}

/**
 * Initialize translation system
 * Sets lang attribute early to prevent FOUC, then applies translations when DOM is ready
 */
function initTranslationSystem() {
    // Get preferred language early
    const preferredLang = getPreferredLanguage();
    
    // Set HTML lang attribute immediately (before DOMContentLoaded)
    // This prevents FOUC (Flash of Untranslated Content)
    if (document.documentElement) {
        document.documentElement.lang = preferredLang;
    }
    
    // Apply translations when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
            translatePage(preferredLang);
        });
    } else {
        // DOM is already loaded
        translatePage(preferredLang);
    }
}

// Make toggleLanguage globally accessible
window.toggleLanguage = toggleLanguage;

// Initialize translation system
initTranslationSystem();
